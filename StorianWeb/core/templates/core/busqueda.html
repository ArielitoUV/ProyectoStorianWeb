{% extends 'core/base.html' %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'css/styles-busqueda.css' %}">

<div class="search-container">
    <h2>Busqueda de Lugares Historicos</h2>
    <form method="get">
        {{ form.as_p }}
        {% if lugares %}
        <h3>Resultados:</h3>
        <ul>
            {% for lugar in lugares %}
                <li>{{ lugar.nombre }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    </form>
</div>

<script>
    // Añade un evento para detectar cambios en el input de búsqueda
    document.getElementById('id_nombre_lugar').addEventListener('input', function() {
        // Obtiene el valor actual del input
        var nombreLugar = this.value;

        // Realiza una petición AJAX para obtener resultados de autocompletado
        if (nombreLugar.length > 2) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    // Parsea la respuesta JSON y actualiza la lista de resultados
                    var resultados = JSON.parse(xhr.responseText);
                    actualizarResultados(resultados);
                }
            };

            // Realiza la petición GET a la vista de autocompletado
            xhr.open('GET', '/autocompletar_lugares/?nombre_lugar=' + encodeURIComponent(nombreLugar), true);
            xhr.send();
        }
    });

    // Función para actualizar la lista de resultados
    function actualizarResultados(resultados) {
        var listaResultados = document.getElementById('lista-resultados');
        listaResultados.innerHTML = '';

        resultados.forEach(function(lugar) {
            var li = document.createElement('li');
            li.textContent = lugar.nombre;
            listaResultados.appendChild(li);
        });
    }
</script>

{% endblock %}
</body>
</html>


<!-- onclick="buscarLugar()" -->

<!--         <button type="submit" class="btn btn-custom btn-lg" >Buscar</button>
        <button type="button" class="btn btn-custom btn-lg" onclick="accederAMapa()">Acceder a Mapa</button>
 -->